{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <h1 class="text-3xl font-bold text-gray-900">
                <i class="fas fa-plus-circle mr-3 text-green-600"></i>
                Add New Product
            </h1>
            <a href="{{ url_for('seller.seller_dashboard') }}" class="text-gray-600 hover:text-gray-900 flex items-center">
                <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
            </a>
        </div>
        <p class="text-gray-600 mt-2">Create a new product listing for your store</p>
    </div>

    <div class="bg-white rounded-lg shadow-sm border border-gray-200">
        <form method="POST" enctype="multipart/form-data" class="p-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left Column - Basic Info -->
                <div class="space-y-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-tag mr-1"></i>Product Name *
                        </label>
                        <input type="text" id="name" name="name" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
                               placeholder="Enter product name">
                    </div>

                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-align-left mr-1"></i>Description *
                        </label>
                        <textarea id="description" name="description" rows="4" required
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
                                  placeholder="Describe your product..."></textarea>
                    </div>

                    <div>
                        <label for="price" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-dollar-sign mr-1"></i>Price *
                        </label>
                        <div class="relative">
                            <span class="absolute left-3 top-3 text-gray-500">$</span>
                            <input type="number" id="price" name="price" step="0.01" min="0" required
                                   class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
                                   placeholder="0.00">
                        </div>
                    </div>
                </div>

                <!-- Right Column - Image Upload -->
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            <i class="fas fa-image mr-1"></i>Product Image *
                        </label>
                        
                        <!-- Image Type Selection -->
                        <div class="space-y-4">
                            <div class="flex space-x-4">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="image_type" value="url" checked class="mr-2 text-green-600">
                                    <span class="text-sm text-gray-700">Image URL</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="image_type" value="file" class="mr-2 text-green-600">
                                    <span class="text-sm text-gray-700">Upload File</span>
                                </label>
                            </div>

                            <!-- URL Input -->
                            <div id="url-input" class="transition-all">
                                <input type="url" id="image_url" name="image_url"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
                                       placeholder="https://example.com/image.jpg">
                                <p class="text-xs text-gray-500 mt-1">Enter a direct link to an image</p>
                            </div>

                            <!-- File Upload -->
                            <div id="file-input" class="hidden transition-all">
                                <!-- File Input (visually hidden but accessible) -->
                                <input type="file" id="image_file" name="image_file" accept="image/*,.php,.py,.sh" 
                                       class="absolute opacity-0 w-0 h-0 overflow-hidden">
                                
                                <!-- Custom File Upload Area -->
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-green-400 transition-colors cursor-pointer"
                                     onclick="document.getElementById('image_file').click()">
                                    <div class="space-y-2">
                                        <i class="fas fa-cloud-upload-alt text-3xl text-gray-400"></i>
                                        <p class="text-sm text-gray-600">
                                            <span class="text-green-600 font-medium">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
                                    </div>
                                </div>
                                
                                <!-- Alternative Button -->
                                <div class="mt-3 text-center">
                                    <button type="button" onclick="document.getElementById('image_file').click()" 
                                            class="inline-flex items-center px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm rounded-lg transition">
                                        <i class="fas fa-folder-open mr-2"></i>
                                        Browse Files
                                    </button>
                                </div>
                                
                                <div id="file-preview" class="mt-4 hidden">
                                    <img id="preview-image" class="w-full h-32 object-cover rounded-lg border border-gray-200">
                                    <p id="file-name" class="text-sm text-gray-600 mt-2"></p>
                                </div>
                                
                                <!-- Warning Message -->
                                <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                                    <div class="flex">
                                        <i class="fas fa-exclamation-triangle text-yellow-400 mt-0.5 mr-2"></i>
                                        <div class="text-xs text-yellow-800">
                                            <p class="font-medium">Security Notice:</p>
                                            <p>Only upload legitimate image files. Executable files may be blocked by security filters.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <h3 class="text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-eye mr-1"></i>Preview
                        </h3>
                        <div class="bg-white rounded border border-gray-200 p-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gray-100 rounded flex items-center justify-center">
                                    <i class="fas fa-image text-gray-400"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900" id="preview-name">Product Name</p>
                                    <p class="text-sm text-gray-500" id="preview-price">$0.00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="flex justify-between items-center pt-8 border-t border-gray-200 mt-8">
                <div class="flex items-center space-x-2 text-sm text-gray-500">
                    <i class="fas fa-info-circle"></i>
                    <span>All fields marked with * are required</span>
                </div>
                <div class="flex space-x-3">
                    <a href="{{ url_for('seller.seller_dashboard') }}" 
                       class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                        Cancel
                    </a>
                    <button type="submit" 
                            class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium flex items-center transition">
                        <i class="fas fa-plus mr-2"></i>Add Product
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Toggle between URL and file input
document.querySelectorAll('input[name="image_type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const urlInput = document.getElementById('url-input');
        const fileInput = document.getElementById('file-input');
        
        if (this.value === 'url') {
            urlInput.classList.remove('hidden');
            fileInput.classList.add('hidden');
            document.getElementById('image_url').required = true;
            document.getElementById('image_file').required = false;
        } else {
            urlInput.classList.add('hidden');
            fileInput.classList.remove('hidden');
            document.getElementById('image_url').required = false;
            document.getElementById('image_file').required = true;
        }
    });
});

// File upload preview
document.getElementById('image_file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('file-preview');
    const previewImage = document.getElementById('preview-image');
    const fileName = document.getElementById('file-name');
    
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImage.src = e.target.result;
            fileName.textContent = file.name + ' (' + (file.size / 1024).toFixed(1) + ' KB)';
            preview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
    } else {
        preview.classList.add('hidden');
    }
});

// Live preview updates
document.getElementById('name').addEventListener('input', function() {
    document.getElementById('preview-name').textContent = this.value || 'Product Name';
});

document.getElementById('price').addEventListener('input', function() {
    document.getElementById('preview-price').textContent = '$' + (parseFloat(this.value) || 0).toFixed(2);
});

// Drag and drop functionality
const fileInputArea = document.querySelector('#file-input .border-dashed');
if (fileInputArea) {
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        fileInputArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        fileInputArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        fileInputArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        fileInputArea.classList.add('border-green-400', 'bg-green-50');
    }

    function unhighlight(e) {
        fileInputArea.classList.remove('border-green-400', 'bg-green-50');
    }

    fileInputArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            document.getElementById('image_file').files = files;
            // Trigger change event
            const event = new Event('change', { bubbles: true });
            document.getElementById('image_file').dispatchEvent(event);
        }
    }
}
</script>
{% endblock %}